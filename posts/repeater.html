<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.61">
    <link rel="icon" href="/assets/avatar.png"><link rel="apple-touch-icon" href="/assets/avatar.png"><title>Repeater - 分析与设计 | Tackoil's WebSite</title><meta name="description" content="从最开始想写一个群机器人，到现在也有陆续一个月了。现在这个bot的最好记录是在一个非常水的群里复读了一周后才被发现。至于为什么想要写这样一个bot，可能也是突然意识到自己经常在群里聊天也只是复读其他的话。">
    <link rel="preload" href="/assets/style-a6f4830c.css" as="style"><link rel="stylesheet" href="/assets/style-a6f4830c.css">
    <link rel="modulepreload" href="/assets/app-c9fab85c.js"><link rel="modulepreload" href="/assets/framework-1508a596.js"><link rel="modulepreload" href="/assets/repeater.html-94304ced.js"><link rel="modulepreload" href="/assets/repeater.html-fd93589d.js"><link rel="prefetch" href="/assets/index.html-eb8c85a2.js" as="script"><link rel="prefetch" href="/assets/about.html-91f1e27d.js" as="script"><link rel="prefetch" href="/assets/links.html-2eb2e38a.js" as="script"><link rel="prefetch" href="/assets/2021-winter-solstice.html-61365fa2.js" as="script"><link rel="prefetch" href="/assets/2021a10.html-5477114f.js" as="script"><link rel="prefetch" href="/assets/2021s12.html-6be15c11.js" as="script"><link rel="prefetch" href="/assets/2022-winter-solstice.html-f058b686.js" as="script"><link rel="prefetch" href="/assets/2023-summer-solstice.html-7f466ccb.js" as="script"><link rel="prefetch" href="/assets/2023-winter-solstice.html-1f029375.js" as="script"><link rel="prefetch" href="/assets/axios-promise.html-17f0856e.js" as="script"><link rel="prefetch" href="/assets/css-hacky.html-ee503659.js" as="script"><link rel="prefetch" href="/assets/js-destructuring-assignment.html-5e0ba172.js" as="script"><link rel="prefetch" href="/assets/linguistics.html-47836ab6.js" as="script"><link rel="prefetch" href="/assets/metrics.html-af21ffb3.js" as="script"><link rel="prefetch" href="/assets/nn0.html-b3d03f0c.js" as="script"><link rel="prefetch" href="/assets/oped-view.html-994e76b2.js" as="script"><link rel="prefetch" href="/assets/oped-view2.html-a1913a70.js" as="script"><link rel="prefetch" href="/assets/pcrtest.html-7e5c31c2.js" as="script"><link rel="prefetch" href="/assets/404.html-e0575d4e.js" as="script"><link rel="prefetch" href="/assets/index.html-3b00b1e7.js" as="script"><link rel="prefetch" href="/assets/about.html-62eef9fe.js" as="script"><link rel="prefetch" href="/assets/links.html-d4412946.js" as="script"><link rel="prefetch" href="/assets/2021-winter-solstice.html-6804d0dc.js" as="script"><link rel="prefetch" href="/assets/2021a10.html-2dc2b5ab.js" as="script"><link rel="prefetch" href="/assets/2021s12.html-8a7c2b08.js" as="script"><link rel="prefetch" href="/assets/2022-winter-solstice.html-eb6388a4.js" as="script"><link rel="prefetch" href="/assets/2023-summer-solstice.html-cae31e79.js" as="script"><link rel="prefetch" href="/assets/2023-winter-solstice.html-d8444542.js" as="script"><link rel="prefetch" href="/assets/axios-promise.html-9b9e9f65.js" as="script"><link rel="prefetch" href="/assets/css-hacky.html-620b5808.js" as="script"><link rel="prefetch" href="/assets/js-destructuring-assignment.html-e46e743f.js" as="script"><link rel="prefetch" href="/assets/linguistics.html-f90b03cc.js" as="script"><link rel="prefetch" href="/assets/metrics.html-77c2ecc8.js" as="script"><link rel="prefetch" href="/assets/nn0.html-acc71412.js" as="script"><link rel="prefetch" href="/assets/oped-view.html-05745966.js" as="script"><link rel="prefetch" href="/assets/oped-view2.html-5dfee8e5.js" as="script"><link rel="prefetch" href="/assets/pcrtest.html-c0ed3304.js" as="script"><link rel="prefetch" href="/assets/404.html-9fc9f571.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><header class="nav-bar"><div class="nav-bar-container"><span class="nav-bar__title">Tackoil&#39;s WebSite</span><div class="button-group"><!--[--><button class="button-group__button"><i class="iconfont icon-home"></i><div class="shrink-content" style="width:40px;"><div><!--[--><span>首页</span><!--]--></div></div></button><button class="button-group__button"><i class="iconfont icon-user"></i><div class="shrink-content" style="width:40px;"><div><!--[--><span>关于</span><!--]--></div></div></button><button class="button-group__button"><i class="iconfont icon-link"></i><div class="shrink-content" style="width:40px;"><div><!--[--><span>友链</span><!--]--></div></div></button><!--]--></div></div></header><div class="head-pic" style="transform:translateY(NaNpx);"><div class="head-pic__title" style="transform:translateY(-0vh);">Repeater - 分析与设计</div><div class="head-pic__mask"></div><div class="head-pic__pic" style="filter:blur(0px);background-image:url(/headpics/illust_91767918_20210810_192545.jpg);"></div></div><div class="page-card__container" style="transform:translateY(-0vh);margin-bottom:-0vh;"><div class="page-card"><!--[--><!--[--><!--[--><div class="post-title">Repeater - 分析与设计</div><div class="markdown-body markdown-body--indent"><p>从最开始想写一个群机器人，到现在也有陆续一个月了。现在这个bot的最好记录是在一个非常水的群里复读了一周后才被发现。至于为什么想要写这样一个bot，可能也是突然意识到自己经常在群里聊天也只是复读其他的话。</p><blockquote><p>其实 Repeater 本身翻译过来是 <strong>中继器</strong> 的意思。</p></blockquote><h1 id="群聊消息分析" tabindex="-1"><a class="header-anchor" href="#群聊消息分析" aria-hidden="true">#</a> 群聊消息分析</h1><h2 id="复读定义" tabindex="-1"><a class="header-anchor" href="#复读定义" aria-hidden="true">#</a> 复读定义</h2><p>{% note info %} 🔁 由多人或单人连续发送相同内容的行为 {% endnote %}</p><ul><li>发送者：可能是同一人，也可能是多个人</li><li>发送时间：连续发送，小概率不连续发送</li><li>发送内容：完全相同的消息（<s>暂时不考虑劣质复读的情况</s>）</li></ul><h3 id="可复读消息" tabindex="-1"><a class="header-anchor" href="#可复读消息" aria-hidden="true">#</a> 可复读消息</h3><p>{% note info %} 🔁 重复该消息不会被认为是“不合常理的（unreasonable）”，被认为是人类能做出的行为。 {% endnote %}</p><p>例如：？、好、yyds、😰、不亏、草、哈哈哈、笑死、开摆！、呜呜</p><p>或者更长的例子：</p><ul><li>居然不复读</li><li>一睁眼怎么又周一了</li><li>i hope🙏</li><li>群友能不能学会然后合宿做给我吃</li><li>我有[Face: 流泪][Face: 流泪][Face: 流泪][Face: 流泪][Face: 流泪]</li><li>……</li></ul><h2 id="基础数据分析" tabindex="-1"><a class="header-anchor" href="#基础数据分析" aria-hidden="true">#</a> 基础数据分析</h2><h3 id="群消息统计" tabindex="-1"><a class="header-anchor" href="#群消息统计" aria-hidden="true">#</a> 群消息统计</h3><h4 id="群消息中连续重复的消息数量的统计" tabindex="-1"><a class="header-anchor" href="#群消息中连续重复的消息数量的统计" aria-hidden="true">#</a> 群消息中连续重复的消息数量的统计</h4><p><img src="/assets/length_distribution-9e2b90a1.png" alt="群消息中连续重复的消息数量的统计"></p><h4 id="群消息的时间分布统计" tabindex="-1"><a class="header-anchor" href="#群消息的时间分布统计" aria-hidden="true">#</a> 群消息的时间分布统计</h4><blockquote><p>时间单位是分钟，以北京时间（GMT+8）为标准</p></blockquote><p><img src="/assets/tf-8edf8acf.png" alt="群消息的时间分布统计.png"></p><h3 id="可复读消息统计" tabindex="-1"><a class="header-anchor" href="#可复读消息统计" aria-hidden="true">#</a> 可复读消息统计</h3><ul><li>当前进入可复读消息集合的规则：100条消息的滑动窗口中出现不少于3次</li><li>所有进入过可复读消息集合的消息：758条</li><li>标注后的有价值的复读消息： <ul><li>Golden（在多个群出现过）10条：确实、😄、？、乐、好似喵、呜呜、好、听不懂，说人话、草、[图片]</li><li>Silver（只在一个群出现过，但成功引发过<strong>连续</strong>的复读事件）116条</li></ul></li></ul><blockquote><p>以下特征的评价标准将以上述*10+116=*126条作为分类任务的正例。</p></blockquote><h2 id="可复读消息的特征" tabindex="-1"><a class="header-anchor" href="#可复读消息的特征" aria-hidden="true">#</a> 可复读消息的特征</h2><h3 id="时间滑动窗口中的频次-tf模式" tabindex="-1"><a class="header-anchor" href="#时间滑动窗口中的频次-tf模式" aria-hidden="true">#</a> 时间滑动窗口中的频次（TF模式）</h3><p>使用 <strong>时间滑动窗口中的频次</strong> 对可复读消息的分布进行建模，包含以下参数：</p><ul><li>滑动窗口的时间大小：$T$</li><li>滑动窗口中的最小命中频次：$F$</li></ul><blockquote><p>由不知道哪个时间单位更好，所以分为“秒级别”与“分钟级别”</p></blockquote><blockquote><p>一票否决方案 表示模型如果不能召回所有的 Golden消息，则该模型的 F1 分数为0。没有该限制则称为 标准方案</p></blockquote><table><thead><tr><th>级别</th><th>方案</th><th>T</th><th>F</th><th>F1</th></tr></thead><tbody><tr><td>秒级别</td><td>一票否决</td><td>140秒</td><td>3次</td><td>0.2550</td></tr><tr><td>秒级别</td><td>标准</td><td>10秒</td><td>3次</td><td>0.3333</td></tr><tr><td>分钟级别</td><td>一票否决</td><td>600秒（10分钟）</td><td>3次</td><td>0.2214</td></tr><tr><td>分钟级别</td><td>标准</td><td>600秒（10分钟）</td><td>4次</td><td>0.2673</td></tr></tbody></table><p>TF模式一票否决方案下较难预测的Golden消息（8）：确实、呜呜、乐、好、😄、 听不懂，说人话、好似喵、[图片]</p><h3 id="消息滑动窗口中的频次-wf模式" tabindex="-1"><a class="header-anchor" href="#消息滑动窗口中的频次-wf模式" aria-hidden="true">#</a> 消息滑动窗口中的频次（WF模式）</h3><p>不考虑消息的发送时间，使用 <strong>基于消息数量的滑动窗口中的频次</strong> 对可复读消息的分布进行建模，包含以下参数：</p><ul><li>滑动窗口的消息数量：$W$</li><li>滑动窗口中的最小命中频次：$F$</li></ul><table><thead><tr><th>方案</th><th>W</th><th>F</th><th>F1</th></tr></thead><tbody><tr><td>一票否决</td><td>80</td><td>4</td><td>0.1114</td></tr><tr><td>标准</td><td>40</td><td>23</td><td>0.2126</td></tr></tbody></table><ul><li>WF模式一票否决方案下较难预测的Golden消息（2）：听不懂，说人话、好似喵</li></ul><h3 id="被连续发送的次数-f模式" tabindex="-1"><a class="header-anchor" href="#被连续发送的次数-f模式" aria-hidden="true">#</a> 被连续发送的次数（F模式）</h3><p>使用 <strong>连续的相同消息的次数</strong> 对可复读消息的分布进行建模，包含以下参数：</p><ul><li>连续发送的最小次数：$F$</li></ul><table><thead><tr><th>方案</th><th>F</th><th>F1</th></tr></thead><tbody><tr><td>一票否决</td><td>-</td><td>0</td></tr><tr><td>标准</td><td>3</td><td>0.5508</td></tr></tbody></table><p><img src="/assets/repeat_send_heat_map_f1-557de855.png" alt="连续发送次数"></p><h3 id="消息文字长度" tabindex="-1"><a class="header-anchor" href="#消息文字长度" aria-hidden="true">#</a> 消息文字长度</h3><p>把图片、转发、at等特殊消息视为长度为1的消息。统计可复读消息中占所有消息的比例。</p><p><img src="/assets/message_length_prob-30137bf0.png" alt="消息文字长度分布"></p><p>可以发现好像并没有什么严格的规律，概率都不到0.5%</p><h3 id="结论" tabindex="-1"><a class="header-anchor" href="#结论" aria-hidden="true">#</a> 结论</h3><ol><li>绝大部分可复读消息都在所有消息中连续多次出现。</li><li>基于时间的滑动窗口方案（TF模式）比基于数量的滑动窗口方案（WF模式）性能更高，但两方案相比连续发送次数方案（F模式）存在 <em>准确率</em> 较低的情况。</li><li>无法通过消息文字长度预测是否为可复读消息。</li></ol><h2 id="复读行为的特征" tabindex="-1"><a class="header-anchor" href="#复读行为的特征" aria-hidden="true">#</a> 复读行为的特征</h2><h3 id="复读是否发生的概率" tabindex="-1"><a class="header-anchor" href="#复读是否发生的概率" aria-hidden="true">#</a> 复读是否发生的概率</h3><h4 id="基础概率复读-p模式" tabindex="-1"><a class="header-anchor" href="#基础概率复读-p模式" aria-hidden="true">#</a> 基础概率复读（p模式）</h4><p>设消息列表中 一个可复读消息 后的消息是 与前一个相同的消息 的概率为 $p=0.1198$</p><p>随机执行测试（10000次）结果如下：</p><table><thead><tr><th>最小值</th><th>最大值</th><th>平均值</th><th>中位数</th></tr></thead><tbody><tr><td>0.7105</td><td>0.7443</td><td>0.7281</td><td>0.7281</td></tr></tbody></table><h4 id="指数累进概率复读-pd模式" tabindex="-1"><a class="header-anchor" href="#指数累进概率复读-pd模式" aria-hidden="true">#</a> 指数累进概率复读（pd模式）</h4><p>设消息列表中 一个可复读消息 后的第一个消息是同一个可复读消息的概率为 $p$。前$k-1$个消息都是同一个可复读消息的情况下，第$k$个消息是同一个可复读消息的概率为$p \cdot d^{k-1}$。先统计在不同的$k$ 下的概率情况。</p><table><thead><tr><th>k</th><th>条件概率</th><th>k</th><th>条件概率</th><th>k</th><th>条件概率</th></tr></thead><tbody><tr><td>1</td><td>0.0737</td><td>5</td><td>0.5965</td><td>9</td><td>0.5556</td></tr><tr><td>2</td><td>0.4276</td><td>6</td><td>0.4706</td><td>10</td><td>0.6</td></tr><tr><td>3</td><td>0.4436</td><td>7</td><td>0.6875</td><td>11</td><td>0.6667</td></tr><tr><td>4</td><td>0.5</td><td>8</td><td>0.8182</td><td>12</td><td>1</td></tr></tbody></table><p>用指数函数拟合这一概率，得到</p><p>$$ p=0.3430,\ d=1.0888 $$</p><p>随机执行测试（10000次）结果如下：</p><table><thead><tr><th>最小值</th><th>0.6021</th></tr></thead><tbody><tr><td>最大值</td><td>0.6397</td></tr><tr><td>平均值</td><td>0.6195</td></tr><tr><td>中位数</td><td>0.6195</td></tr></tbody></table><p><img src="/assets/opti-32b78929.png" alt="指数累进概率拟合"></p><h4 id="负指数累进复读模式-q模式" tabindex="-1"><a class="header-anchor" href="#负指数累进复读模式-q模式" aria-hidden="true">#</a> 负指数累进复读模式（q模式）</h4><p>设消息列表中 一个可复读消息 后的第一个消息是同一个可复读消息的概率为 $1-q$。前$k-1$个消息都是同一个可复读消息的情况下，第$k$个消息是同一个可复读消息的概率为$1-q^k$。拟合这一概率，得到</p><p>$$ q=0.8624 $$</p><p>随机执行测试（10000次）结果如下：</p><table><thead><tr><th>最小值</th><th>0.7595</th></tr></thead><tbody><tr><td>最大值</td><td>0.7904</td></tr><tr><td>平均值</td><td>0.7751</td></tr><tr><td>中位数</td><td>0.7751</td></tr></tbody></table><p><img src="/assets/opti_p-26af63f6.png" alt="负指数累进概率拟合"></p><h3 id="复读间隔时间的分布" tabindex="-1"><a class="header-anchor" href="#复读间隔时间的分布" aria-hidden="true">#</a> 复读间隔时间的分布</h3><p>TBD</p><h3 id="结论-1" tabindex="-1"><a class="header-anchor" href="#结论-1" aria-hidden="true">#</a> 结论</h3><ol><li>负指数累进复读模式（q模式）可能更加符合实际复读行为</li><li>不同的累进复读模式的效果差距很大，可能存在更好的累进复读方案。</li><li>基础概率复读的阈值应较低</li></ol><h2 id="进一步分析计划" tabindex="-1"><a class="header-anchor" href="#进一步分析计划" aria-hidden="true">#</a> 进一步分析计划</h2><ol><li>目前的分析都是从实验的角度进行的。不知是否可以进一步使用统计学知识从建模的角度进行分析。</li><li>现有方案对可复读消息的判断性能较低。</li></ol><h1 id="roadmap" tabindex="-1"><a class="header-anchor" href="#roadmap" aria-hidden="true">#</a> Roadmap</h1><ul><li>[x] 基础概率复读</li><li>[x] 冷却时间</li><li>[x] 引入Mongo</li><li>[x] 配置支持</li><li>[x] 多群支持（可发布）</li><li>[x] 支持图片复读</li><li>[x] 关键词排除</li><li>[x] 累进复读概率</li><li>[ ] 随机丢弃已保存消息（idea by 719）</li><li>[ ] 多人复读判断引入</li></ul></div><!--]--><!--]--><!--]--></div></div><footer class="footer" data-v-c22f8b03><div class="footer-content" data-v-c22f8b03> Base VuePress by <a href="https://github.com/Tackoil/vuepress-theme-anemos" data-v-c22f8b03>Anemos</a></div></footer><!--]--><!--]--></div>
    <script type="module" src="/assets/app-c9fab85c.js" defer></script>
  </body>
</html>
