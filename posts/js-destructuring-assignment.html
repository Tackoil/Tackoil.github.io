<!DOCTYPE html>
<html lang="en-US">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width,initial-scale=1">
    <meta name="generator" content="VuePress 2.0.0-beta.61">
    <link rel="icon" href="/assets/avatar.png"><link rel="apple-touch-icon" href="/assets/avatar.png"><title>JavaScript 的列表解构赋值执行顺序 | Tackoil's WebSite</title><meta name="description" content="这篇文章将简单解释一下 JavaScript 中列表的解构赋值的细节和执行顺序。新特性还是要谨慎使用。">
    <link rel="preload" href="/assets/style-a6f4830c.css" as="style"><link rel="stylesheet" href="/assets/style-a6f4830c.css">
    <link rel="modulepreload" href="/assets/app-c9fab85c.js"><link rel="modulepreload" href="/assets/framework-1508a596.js"><link rel="modulepreload" href="/assets/js-destructuring-assignment.html-5e0ba172.js"><link rel="modulepreload" href="/assets/js-destructuring-assignment.html-e46e743f.js"><link rel="prefetch" href="/assets/index.html-eb8c85a2.js" as="script"><link rel="prefetch" href="/assets/about.html-91f1e27d.js" as="script"><link rel="prefetch" href="/assets/links.html-2eb2e38a.js" as="script"><link rel="prefetch" href="/assets/2021-winter-solstice.html-61365fa2.js" as="script"><link rel="prefetch" href="/assets/2021a10.html-5477114f.js" as="script"><link rel="prefetch" href="/assets/2021s12.html-6be15c11.js" as="script"><link rel="prefetch" href="/assets/2022-winter-solstice.html-f058b686.js" as="script"><link rel="prefetch" href="/assets/2023-summer-solstice.html-7f466ccb.js" as="script"><link rel="prefetch" href="/assets/2023-winter-solstice.html-1f029375.js" as="script"><link rel="prefetch" href="/assets/axios-promise.html-17f0856e.js" as="script"><link rel="prefetch" href="/assets/css-hacky.html-ee503659.js" as="script"><link rel="prefetch" href="/assets/linguistics.html-47836ab6.js" as="script"><link rel="prefetch" href="/assets/metrics.html-af21ffb3.js" as="script"><link rel="prefetch" href="/assets/nn0.html-b3d03f0c.js" as="script"><link rel="prefetch" href="/assets/oped-view.html-994e76b2.js" as="script"><link rel="prefetch" href="/assets/oped-view2.html-a1913a70.js" as="script"><link rel="prefetch" href="/assets/pcrtest.html-7e5c31c2.js" as="script"><link rel="prefetch" href="/assets/repeater.html-fd93589d.js" as="script"><link rel="prefetch" href="/assets/404.html-e0575d4e.js" as="script"><link rel="prefetch" href="/assets/index.html-3b00b1e7.js" as="script"><link rel="prefetch" href="/assets/about.html-62eef9fe.js" as="script"><link rel="prefetch" href="/assets/links.html-d4412946.js" as="script"><link rel="prefetch" href="/assets/2021-winter-solstice.html-6804d0dc.js" as="script"><link rel="prefetch" href="/assets/2021a10.html-2dc2b5ab.js" as="script"><link rel="prefetch" href="/assets/2021s12.html-8a7c2b08.js" as="script"><link rel="prefetch" href="/assets/2022-winter-solstice.html-eb6388a4.js" as="script"><link rel="prefetch" href="/assets/2023-summer-solstice.html-cae31e79.js" as="script"><link rel="prefetch" href="/assets/2023-winter-solstice.html-d8444542.js" as="script"><link rel="prefetch" href="/assets/axios-promise.html-9b9e9f65.js" as="script"><link rel="prefetch" href="/assets/css-hacky.html-620b5808.js" as="script"><link rel="prefetch" href="/assets/linguistics.html-f90b03cc.js" as="script"><link rel="prefetch" href="/assets/metrics.html-77c2ecc8.js" as="script"><link rel="prefetch" href="/assets/nn0.html-acc71412.js" as="script"><link rel="prefetch" href="/assets/oped-view.html-05745966.js" as="script"><link rel="prefetch" href="/assets/oped-view2.html-5dfee8e5.js" as="script"><link rel="prefetch" href="/assets/pcrtest.html-c0ed3304.js" as="script"><link rel="prefetch" href="/assets/repeater.html-94304ced.js" as="script"><link rel="prefetch" href="/assets/404.html-9fc9f571.js" as="script">
  </head>
  <body>
    <div id="app"><!--[--><!--[--><header class="nav-bar"><div class="nav-bar-container"><span class="nav-bar__title">Tackoil&#39;s WebSite</span><div class="button-group"><!--[--><button class="button-group__button"><i class="iconfont icon-home"></i><div class="shrink-content" style="width:40px;"><div><!--[--><span>首页</span><!--]--></div></div></button><button class="button-group__button"><i class="iconfont icon-user"></i><div class="shrink-content" style="width:40px;"><div><!--[--><span>关于</span><!--]--></div></div></button><button class="button-group__button"><i class="iconfont icon-link"></i><div class="shrink-content" style="width:40px;"><div><!--[--><span>友链</span><!--]--></div></div></button><!--]--></div></div></header><div class="head-pic" style="transform:translateY(NaNpx);"><div class="head-pic__title" style="transform:translateY(-0vh);">JavaScript 的列表解构赋值执行顺序</div><div class="head-pic__mask"></div><div class="head-pic__pic" style="filter:blur(0px);background-image:url(https://wonder-egg-priority.com/assets/img/top/main/visual.jpg);"></div></div><div class="page-card__container" style="transform:translateY(-0vh);margin-bottom:-0vh;"><div class="page-card"><!--[--><!--[--><!--[--><div class="post-title">JavaScript 的列表解构赋值执行顺序</div><div class="markdown-body markdown-body--indent"><p>这篇文章将简单解释一下 JavaScript 中列表的解构赋值的细节和执行顺序。新特性还是要谨慎使用。</p><!-- more --><h1 id="起因" tabindex="-1"><a class="header-anchor" href="#起因" aria-hidden="true">#</a> 起因</h1><p>在有次 leetcode 中的经典题目 <a href="https://leetcode-cn.com/problems/shu-zu-zhong-zhong-fu-de-shu-zi-lcof/" target="_blank" rel="noopener noreferrer">剑指 Offer 03. 数组中重复的数字</a> 中遇到一个小问题。简单概括，这道题需要从左往右依次将数字放到对应下标上，直到发现两个相同的数字为止。一个很直观的想法就是使用解构赋值以避免使用程序员搬家。完整的程序就大概是长下面这个样子。</p><div class="language-javascript line-numbers-mode" data-ext="js"><pre class="language-javascript"><code><span class="token keyword">var</span> <span class="token function-variable function">findRepeatNumber</span> <span class="token operator">=</span> <span class="token keyword">function</span><span class="token punctuation">(</span><span class="token parameter">nums</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
    <span class="token keyword">for</span><span class="token punctuation">(</span><span class="token keyword">let</span> i<span class="token operator">=</span><span class="token number">0</span><span class="token punctuation">;</span> i<span class="token operator">&lt;</span>nums<span class="token punctuation">.</span>length<span class="token punctuation">;</span> i<span class="token operator">++</span><span class="token punctuation">)</span><span class="token punctuation">{</span>
        <span class="token keyword">while</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">!==</span> i<span class="token punctuation">)</span><span class="token punctuation">{</span>
            <span class="token comment">// The following line will not work as the expect.</span>
            <span class="token punctuation">[</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">,</span> nums<span class="token punctuation">[</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">]</span> <span class="token operator">=</span> <span class="token punctuation">[</span>nums<span class="token punctuation">[</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">,</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span>
            <span class="token keyword">if</span><span class="token punctuation">(</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span> <span class="token operator">===</span> nums<span class="token punctuation">[</span>nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">]</span><span class="token punctuation">)</span> <span class="token keyword">return</span> nums<span class="token punctuation">[</span>i<span class="token punctuation">]</span><span class="token punctuation">;</span>
        <span class="token punctuation">}</span>
    <span class="token punctuation">}</span>
    <span class="token keyword">return</span> <span class="token operator">-</span><span class="token number">1</span><span class="token punctuation">;</span>
<span class="token punctuation">}</span><span class="token punctuation">;</span>

console<span class="token punctuation">.</span><span class="token function">log</span><span class="token punctuation">(</span><span class="token function">findRepeatNumber</span><span class="token punctuation">(</span><span class="token punctuation">[</span><span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">,</span> <span class="token number">1</span><span class="token punctuation">,</span> <span class="token number">0</span><span class="token punctuation">,</span> <span class="token number">2</span><span class="token punctuation">,</span> <span class="token number">5</span><span class="token punctuation">,</span> <span class="token number">3</span><span class="token punctuation">]</span><span class="token punctuation">)</span><span class="token punctuation">)</span>
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>如果输入进行测试，可以喜闻乐见地发现 TLE 了。这么简单的代码应该不会超时啊。</p><h1 id="调试" tabindex="-1"><a class="header-anchor" href="#调试" aria-hidden="true">#</a> 调试</h1><p>在每次交换后输出 <code>nums</code> 观察结果。第一步的输出显然应该是 <code>[1, 3, 2, 0, 2, 5, 3]</code> ，因为把<code>2</code>移动到了下标<code>2</code>上，和原本那个位置上的数字<code>1</code>进行交换。然而实际上是这样的：</p><div class="language-text line-numbers-mode" data-ext="text"><pre class="language-text"><code>[ 1, 2, 1, 0, 2, 5, 3 ]
[ 2, 2, 1, 0, 2, 5, 3 ]
[ 1, 2, 1, 0, 2, 5, 3 ]
[ 2, 2, 1, 0, 2, 5, 3 ]
...
</code></pre><div class="line-numbers" aria-hidden="true"><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div><div class="line-number"></div></div></div><p>发现第一行输出就与期望值严重不符。从输出实在看不出来原因，就调试了一下。</p><p><img src="/assets/jsdebug-b5d1a24a.png" alt="调试中" title="调试中"></p><p>可以发现调试步骤可以停在左侧列表中的第二项。意味着 JavaScript 会先对左侧第一项<code>nums[i]</code>进行赋值并存储，然后再对第二项<code>nums[nums[i]]</code>进行赋值。可以发现在赋值左侧第二项时，索引<code>nums[i]</code>已经发生了修改，也就导致无法正常工作了。</p><p>结合上面的例子。<code>i=0</code>时，<code>nums[i]=1</code>。<code>nums[nums[i]]=2</code>。因此第0项赋值为<code>2</code>，然后对第2项赋值为1。最终得到上面的结果。（当然，死循环是巧合，并非每次都会触发。）</p><h1 id="总结" tabindex="-1"><a class="header-anchor" href="#总结" aria-hidden="true">#</a> 总结</h1><p>当时觉得这个问题只有 JavaScript 才会遇到，Python是没问题的。后来实验了一下，Python也是按照这种方式进行赋值的。所以还是尽量不要写这种奇怪的语法吧。</p></div><!--]--><!--]--><!--]--></div></div><footer class="footer" data-v-c22f8b03><div class="footer-content" data-v-c22f8b03> Base VuePress by <a href="https://github.com/Tackoil/vuepress-theme-anemos" data-v-c22f8b03>Anemos</a></div></footer><!--]--><!--]--></div>
    <script type="module" src="/assets/app-c9fab85c.js" defer></script>
  </body>
</html>
